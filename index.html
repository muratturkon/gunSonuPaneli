<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>G√ºn Sonu ƒ∞cmal ve ƒ∞craatler</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    font-family:Arial, sans-serif;
    background:#f2f4f7;
    padding:15px;
}
.kart{
    max-width:480px;
    margin:auto;
    background:#fff;
    border-radius:14px;
    box-shadow:0 6px 18px rgba(0,0,0,.12);
    overflow:hidden;
}
.baslik{
    padding:14px;
    color:#fff;
    font-size:18px;
    font-weight:bold;
    text-align:center;
    background:linear-gradient(90deg,#c62828,#1565c0);
}
.icerik{padding:15px;}
input, textarea{
    width:100%;
    box-sizing:border-box;
    padding:10px;
    margin-top:6px;
    margin-bottom:12px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:15px;
}
label{font-size:14px;font-weight:bold}
textarea{min-height:80px;resize:vertical}

.kaydetBtn{
    width:100%;
    border:none;
    padding:12px;
    font-size:16px;
    font-weight:bold;
    border-radius:10px;
    color:#fff;
    background:linear-gradient(90deg,#c62828,#1565c0);
    cursor:pointer;
}

.onay{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,.4);
    z-index:999;
}
.onay span{
    width:120px;
    height:120px;
    border-radius:50%;
    background:#2e7d32;
    color:#fff;
    font-size:60px;
    display:flex;
    align-items:center;
    justify-content:center;
}
</style>
</head>

<body>

<div class="kart">
    <div class="baslik">G√ºn Sonu ƒ∞cmal ve ƒ∞craatler</div>
    <div class="icerik">

        <label>Ekip Kodu</label>
        <input id="ekip" placeholder="Ekip kodunu giriniz">

        <label>GBT Sayƒ±sƒ±</label>
        <input id="gbt" type="number">

        <label>Ara√ß Sorgu</label>
        <input id="arac" type="number">

        <label>Motosiklet Sorgu</label>
        <input id="moto" type="number">

        <label>Tutanak</label>
        <input id="tutanak" type="number">

        <label>ƒ∞craat</label>
        <textarea id="icraat"></textarea>

        <button class="kaydetBtn" id="kaydet">KAYDET</button>
    </div>
</div>

<div class="onay" id="onay">
    <span>üëç</span>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, get, onValue } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyCO_T8tpzN3YIuPxptuT_E1MdQJigvMpqI",
  authDomain: "ekip-donanim.firebaseapp.com",
  databaseURL: "https://ekip-donanim-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ekip-donanim",
  storageBucket: "ekip-donanim.firebasestorage.app",
  messagingSenderId: "1073029846962",
  appId: "1:1073029846962:web:8a5d65d054e4ec0ac2f6ab"
};

initializeApp(firebaseConfig);
const db = getDatabase();

/* Elemanlar */
const ekip = document.getElementById("ekip");
const gbt = document.getElementById("gbt");
const arac = document.getElementById("arac");
const moto = document.getElementById("moto");
const tutanak = document.getElementById("tutanak");
const icraat = document.getElementById("icraat");
const onay = document.getElementById("onay");

function bugun(){
    return new Date().toISOString().split("T")[0];
}

/* üîπ Ekip kodu girilince eski veriyi getir */
ekip.addEventListener("blur", async () => {
    if(!ekip.value.trim()) return;

    const yol = ref(db, `gunSonuIcmal/${bugun()}/${ekip.value.trim()}`);
    const snap = await get(yol);

    if(snap.exists()){
        const d = snap.val();
        gbt.value = d.gbt ?? "";
        arac.value = d.arac ?? "";
        moto.value = d.moto ?? "";
        tutanak.value = d.tutanak ?? "";
        icraat.value = d.icraat ?? "";
    }
});

/* üîπ Kaydet (overwrite) */
document.getElementById("kaydet").onclick = async () => {
    if(!ekip.value.trim()) return;

    const data = {
        gbt: Number(gbt.value||0),
        arac: Number(arac.value||0),
        moto: Number(moto.value||0),
        tutanak: Number(tutanak.value||0),
        icraat: icraat.value || "",
        guncelleme: new Date().toLocaleString("tr-TR")
    };

    await set(
        ref(db, `gunSonuIcmal/${bugun()}/${ekip.value.trim()}`),
        data
    );

    onay.style.display="flex";
    setTimeout(()=>onay.style.display="none",2000);
};
</script>

</body>
</html>
